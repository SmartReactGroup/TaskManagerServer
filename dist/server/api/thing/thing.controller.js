"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _deleteProperty=require("babel-runtime/core-js/reflect/delete-property"),_deleteProperty2=_interopRequireDefault(_deleteProperty),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);exports.index=index,exports.show=show,exports.create=create,exports.upsert=upsert,exports.patch=patch,exports.destroy=destroy;var _fastJsonPatch=require("fast-json-patch"),_thing=require("./thing.model"),_thing2=_interopRequireDefault(_thing);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function respondWithResult(e,t){return t=t||200,function(r){return r?e.status(t).json(r):null}}function patchUpdates(e){return function(t){try{(0,_fastJsonPatch.applyPatch)(t,e,!0)}catch(e){return _promise2.default.reject(e)}return t.save()}}function removeEntity(e){return function(t){if(t)return t.remove().then(function(){return e.status(204).end()})}}function handleEntityNotFound(e){return function(t){return t||(e.status(404).end(),null)}}function handleError(e,t){return t=t||500,function(r){e.status(t).send(r)}}function index(e,t){return _thing2.default.find().exec().then(respondWithResult(t)).catch(handleError(t))}function show(e,t){return _thing2.default.findById(e.params.id).exec().then(handleEntityNotFound(t)).then(respondWithResult(t)).catch(handleError(t))}function create(e,t){return _thing2.default.create(e.body).then(respondWithResult(t,201)).catch(handleError(t))}function upsert(e,t){return e.body._id&&(0,_deleteProperty2.default)(e.body,"_id"),_thing2.default.findOneAndUpdate({_id:e.params.id},e.body,{new:!0,upsert:!0,setDefaultsOnInsert:!0,runValidators:!0}).exec().then(respondWithResult(t)).catch(handleError(t))}function patch(e,t){return e.body._id&&(0,_deleteProperty2.default)(e.body,"_id"),_thing2.default.findById(e.params.id).exec().then(handleEntityNotFound(t)).then(patchUpdates(e.body)).then(respondWithResult(t)).catch(handleError(t))}function destroy(e,t){return _thing2.default.findById(e.params.id).exec().then(handleEntityNotFound(t)).then(removeEntity(t)).catch(handleError(t))}