{"version":3,"sources":["api/thing/thing.socket.js"],"names":["register","events","spark","event","listener","createListener","ThingEvents","on","removeListener","doc","emit"],"mappings":"AAAA;;;;AAIA;;;;;;;;;;QAOgBA,Q,GAAAA,Q;;AALhB;;;;;;AAEA;AACA,IAAMC,SAAS,CAAC,MAAD,EAAS,QAAT,CAAf;;AAEO,SAASD,QAAT,CAAkBE,KAAlB,EAAyB;AAC9B;AAD8B;AAAA;AAAA;;AAAA;AAE9B,oDAAkBD,MAAlB,4GAA0B;AAAA,UAAjBE,KAAiB;;AACxB,UAAIC,WAAWC,0BAAwBF,KAAxB,EAAiCD,KAAjC,CAAf;;AAEAI,sBAAYC,EAAZ,CAAeJ,KAAf,EAAsBC,QAAtB;AACAF,YAAMK,EAAN,CAAS,YAAT,EAAuBC,eAAeL,KAAf,EAAsBC,QAAtB,CAAvB;AACD;AAP6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ/B;;AAED,SAASC,cAAT,CAAwBF,KAAxB,EAA+BD,KAA/B,EAAsC;AACpC,SAAO,UAASO,GAAT,EAAc;AACnBP,UAAMQ,IAAN,CAAWP,KAAX,EAAkBM,GAAlB;AACD,GAFD;AAGD;;AAED,SAASD,cAAT,CAAwBL,KAAxB,EAA+BC,QAA/B,EAAyC;AACvC,SAAO,YAAW;AAChBE,oBAAYE,cAAZ,CAA2BL,KAA3B,EAAkCC,QAAlC;AACD,GAFD;AAGD","file":"thing.socket.js","sourcesContent":["/**\n * Broadcast updates to client when the model changes\n */\n\n'use strict'\n\nimport ThingEvents from './thing.events'\n\n// Model events to emit\nconst events = ['save', 'remove']\n\nexport function register(spark) {\n  // Bind model events to socket events\n  for (let event of events) {\n    var listener = createListener(`thing:${event}`, spark)\n\n    ThingEvents.on(event, listener)\n    spark.on('disconnect', removeListener(event, listener))\n  }\n}\n\nfunction createListener(event, spark) {\n  return function(doc) {\n    spark.emit(event, doc)\n  }\n}\n\nfunction removeListener(event, listener) {\n  return function() {\n    ThingEvents.removeListener(event, listener)\n  }\n}\n"]}